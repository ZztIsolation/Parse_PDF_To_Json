# PDF分割工具使用说明

## 功能说明

将大型PDF按课程自动分割成多个小PDF文件,**每个课程只保留前3页**(课程目标、毕业要求对应关系、教学内容概览)。

### 功能特点
- ✅ 自动读取PDF的书签/目录结构
- ✅ 按具体课程(二级书签)分割PDF
- ✅ **每个课程只保留前3页**,节省70%转换成本
- ✅ 自动跳过"前言"、"目录"等非课程内容
- ✅ 自动清理文件名中的非法字符
- ✅ 显示详细的分割进度和统计信息

## 安装依赖

```bash
pip install -r requirements.txt
```

或者直接安装:

```bash
pip install pypdf
```

## 使用方法

### 1. 分割PDF

```bash
python src/split_pdf_by_courses.py
```

这个脚本会:
- 将1229页的PDF分割成124个独立的课程PDF
- 每个PDF包含4-29页(平均9.9页)
- 自动跳过"目录"、"前言"等非课程内容
- 文件命名清晰: `002_中国近现代史纲要.pdf`, `064_数据结构.pdf` 等

### 2. 检查分割结果

```bash
python src/check_split_result.py
```

显示详细的统计信息:
- 文件总数和页数分布
- 前20个和后10个文件列表
- 检查是否有一级标题文件

### 修改配置

如果需要处理其他PDF文件,编辑 `split_pdf_by_courses.py` 中的 `main()` 函数:

```python
def main():
    # 配置参数
    input_pdf = "docs/你的PDF文件.pdf"  # 修改输入文件路径
    output_directory = "docs/all"        # 修改输出目录
    # ...
```

### 作为模块导入使用

```python
from src.split_pdf_by_courses import split_pdf_by_level1_bookmarks

split_pdf_by_level1_bookmarks(
    pdf_path="docs/25. 计算机科学与技术专业.pdf",
    output_dir="docs/all"
)
```

## 输出说明

运行后会在控制台显示:

1. **PDF基本信息**: 文件路径、总页数
2. **书签结构分析**: 各层级书签数量、书签预览
3. **分割进度**: 每个文件的生成状态
4. **完成统计**: 成功/失败数量、输出目录

生成的文件命名格式: `001_课程名称.pdf`, `002_课程名称.pdf`, ...

## 参数说明

### `split_pdf_by_bookmarks()` 函数参数

- `pdf_path` (str): 输入PDF文件路径
- `output_dir` (str): 输出目录路径
- `level` (int): 按哪一级书签分割
  - `0`: 一级标题(通常是课程名称)
  - `1`: 二级标题(通常是章节)
  - `2`: 三级标题(通常是小节)

## 常见问题

### Q1: 提示"该PDF没有书签"

**原因**: PDF文件没有目录/书签结构

**解决方案**:
1. 使用PDF阅读器(如Adobe Acrobat)检查是否有书签
2. 如果确实没有书签,需要使用手动指定页码范围的方法

### Q2: 分割后的文件页数不对

**原因**: 书签指向的页码可能不准确

**解决方案**:
1. 查看控制台输出的页码范围
2. 手动调整 `split_level` 参数,尝试不同层级的书签
3. 或使用手动指定页码范围的方法

### Q3: 文件名包含乱码或特殊字符

**原因**: 书签标题包含非法文件名字符

**解决方案**: 代码已自动处理,会将非法字符替换为下划线 `_`

### Q4: 如何查看PDF有哪些书签?

运行脚本后,会自动显示书签结构分析,包括:
- 各层级书签数量
- 前10个一级书签预览

## 示例输出

```
############################################################
# PDF分割工具 - 基于书签自动分割
############################################################

============================================================
📄 PDF信息:
============================================================
  文件路径: docs/25. 计算机科学与技术专业.pdf
  总页数: 1229

============================================================
📚 正在分析PDF书签结构...
============================================================

  📑 发现书签: 高等数学 -> 第 1 页
  📑 发现书签: 线性代数 -> 第 81 页
  📑 发现书签: 概率论 -> 第 151 页
  ...

============================================================
📊 书签层级统计:
============================================================
  一级标题 (level=0): 10 个书签
  二级标题 (level=1): 45 个书签

============================================================
📋 一级书签预览 (前10个):
============================================================
  1. 高等数学 (第 1 页)
  2. 线性代数 (第 81 页)
  3. 概率论 (第 151 页)
  ...

============================================================
✂️  开始分割 (按第 0 级书签)
============================================================
  找到 10 个书签
  预计生成 10 个PDF文件

✅ [1/10] 001_高等数学.pdf
    页码范围: 1-80 (共 80 页)
✅ [2/10] 002_线性代数.pdf
    页码范围: 81-150 (共 70 页)
...

============================================================
🎉 分割完成!
============================================================
  成功: 10/10 个文件
  输出目录: docs/all
```

## 下一步

分割完成后,可以:

1. 检查 `docs/all` 目录中的PDF文件
2. 使用MinerU API或其他工具将这些小PDF转换为Markdown
3. 按课程组织Markdown文件

## 技术支持

如有问题,请检查:
1. pypdf版本是否 >= 4.0.0
2. PDF文件是否损坏
3. 输出目录是否有写入权限

